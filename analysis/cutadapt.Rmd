---
title: "Cutadapt"
author: "Calla Bush St George"
date: "`r Sys.Date()`"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{bash cudadapt}
# If conda not installed
# conda create -n cutadapt cutadapt
# Check if instilation was successful
cutadapt --version
# Activate conda environment
conda activate cutadapt

# cd to correct environment
#cd data/00_cutadapt/01_raw_gzipped_fastqs

# Check if reads are paired
cutadapt -o /dev/null -p /dev/null ERR3585831_1.fastq.gz ERR3585831_2.fastq.gz

# Run command to test on one sample
cutadapt -g TCGTCGGCAGCGTCAGATGTGTATAAGAGACAGCCTACGGGNGGCWGCAG \
-G GTCTCGTGGGCTCGGAGATGTGTATAAGAGACAGGACTACHVGGGTATCTAATCC \
--discard-untrimmed \
-o ERR3585831_trim_1.fastq.gz -p ERR3585831_trim_2.fastq.gz \
ERR3585831_1.fastq.gz ERR3585831_2.fastq.gz

# Run loop on all sample files 
for sample in $(cat ../Bikrim_samples.txt)

do

echo "On sample: $sample"

cutadapt -g TCGTCGGCAGCGTCAGATGTGTATAAGAGACAGCCTACGGGNGGCWGCAG \
-G GTCTCGTGGGCTCGGAGATGTGTATAAGAGACAGGACTACHVGGGTATCTAATCC \
--discard-untrimmed \
-o ${sample}_trim_1.fastq.gz -p ${sample}_trim_2.fastq.gz \
${sample}_1.fastq.gz ${sample}_2.fastq.gz \
>> cutadapt_primer_trimming_stats.txt 2>&1

done

# Check percent reads kept, outputs table below
paste ../Bikrim_samples.txt <(grep "passing" cutadapt_primer_trimming_stats.txt | cut -f3 -d "(" | tr -d ")") <(grep "filtered" cutadapt_primer_trimming_stats.txt | cut -f3 -d "(" | tr -d ")")

```

